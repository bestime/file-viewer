import{libraryFile as e,observeMouseWheel as t}from"@bestime/utils_browser";import{changeIndex as n}from"@bestime/utils_base";function i(e,t,n,i,r,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){i(s,r,a,o,l,"next",e)}function l(e){i(s,r,a,o,l,"throw",e)}o(void 0)}))}}function a(e,t){return e+t}function s(e){return o.apply(this,arguments)}function o(){return(o=r((function*(t){return new Promise((function(n){e({type:"css",module:"",attribute:{author:"bestime"},url:t},n)}))}))).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return(c=r((function*(t){return new Promise((function(n){e({type:"js",module:"pdfjsLib",attribute:{author:"bestime",type:"module"},url:t.index,interceptor:function(e){e.GlobalWorkerOptions.workerSrc=t.worker}},n)}))}))).apply(this,arguments)}function p(){return(p=r((function*(e){var[t]=yield Promise.all([l({index:a(e,"pdf.min.mjs"),worker:a(e,"pdf.worker.mjs")}),s(a(e,"index.min.css"))]);return t}))).apply(this,arguments)}function u(){return u=r((function*(e,t){var i=yield function(e){return p.apply(this,arguments)}(e),a=document.createElement("canvas");a.className="scale-item";var s=document.createElement("div"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("b");o.innerText="上一页",l.innerText="下一页",c.innerText="0/0",s.appendChild(o),s.appendChild(c),s.appendChild(l),s.className="file-viewer-pdf-tool-box";var u=yield i.getDocument(t).promise,d=0;function h(e){return m.apply(this,arguments)}function m(){return(m=r((function*(e){c.innerText=e+"/"+u.numPages;var t=yield u.getPage(e),n=t.getViewport({scale:1}),i=a.getContext("2d");a.height=n.height,a.width=n.width,a.style.width=n.width+"px",a.style.height=n.height+"px";var r={canvasContext:i,viewport:n},s=t.render(r);yield s.promise}))).apply(this,arguments)}return l.onclick=function(){h((d=n(u.numPages-1,d,1))+1)},o.onclick=function(){h((d=n(u.numPages-1,d,-1))+1)},h(1),{tool:s,canvas:a}})),u.apply(this,arguments)}var d="";function h(e){d=e}var m=function(){function e(){var e=this;this._viewrWrapper=void 0,this._viewrBody=void 0,this._scale=1,this._mouseWeelObs=void 0;var n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");n.className="file-viewer-wrapper",r.className="file-viewer-tool",a.className="file-viewer-tool-body",i.className="file-viewer-content";var s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span");s.innerText="上一个",o.innerText="下一个",l.innerText="放大",c.innerText="缩小",r.appendChild(a),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),n.appendChild(r),n.appendChild(i),l.onclick=this._stepBig,c.onclick=this._stepSmall,this._mouseWeelObs=t(n,(function(t){console.log("dir",t),-1===t?e._stepSmall():1===t&&e._stepBig()}),!0),this._viewrBody=i,this._viewrWrapper=n}var n=e.prototype;return n._stepBig=function(){var e=Math.min(this._scale+.1,4);this._setScale(e)},n._stepSmall=function(){var e=Math.max(this._scale-.1,.1);this._setScale(e)},n.show=function(){var e=r((function*(e,t){var n=this,i=yield function(e,t){return u.apply(this,arguments)}(d,t);this._viewrBody.appendChild(i.canvas),this._viewrWrapper.appendChild(i.tool),e.appendChild(this._viewrWrapper),setTimeout((function(){n._updateScale()}),200)}));return function(t,n){return e.apply(this,arguments)}}(),n._setScale=function(e){var t=this._viewrWrapper.getElementsByClassName("scale-item")[0];this._scale=e,t.style.transform="scale("+e+")"},n._updateScale=function(){var e=this._viewrWrapper.getElementsByClassName("scale-item")[0],t=this._viewrWrapper.offsetWidth/e.offsetWidth,n=this._viewrWrapper.offsetHeight/e.offsetHeight;console.log("oBody.offsetWidth",this._viewrWrapper.offsetWidth,e.offsetWidth,e);var i=Math.min(t,n,1);this._setScale(i)},n.dispose=function(){var e;null==this||null===(e=this._mouseWeelObs)||void 0===e||e.dispose()},e}();export{m as default,h as install};
